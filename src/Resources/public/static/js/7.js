(this["webpackJsonpPluginpayone-payment"]=this["webpackJsonpPluginpayone-payment"]||[]).push([[7],{"Jp+7":function(e,n,t){},LNMh:function(e,n,t){"use strict";t.r(n);t("YRDH");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e,n,t){return(n=function(e){var n=function(e,n){if("object"!==i(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"===i(n)?n:String(n)}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var s=Shopware.Mixin;n.default={template:'{% block payone_payment_payment_details %}\n    <div class="payone-refund-button">\n        <sw-container v-tooltip="{message: $tc(\'sw-order.payone-payment.refund.tooltips.impossible\'), disabled: buttonEnabled}" :key="buttonEnabled">\n            <sw-button :disabled="!buttonEnabled" @click="openRefundModal">\n                {{ $tc(\'sw-order.payone-payment.refund.buttonTitle\') }}\n            </sw-button>\n        </sw-container>\n\n        <sw-modal v-if="showRefundModal" @modal-close="closeRefundModal" :title="$tc(`sw-order.payone-payment.modal.refund.title`)" class="payone-payment-detail--refund-modal">\n            <payone-order-items\n                    :order="order"\n                    mode="refund"\n                    v-on:select-item="onSelectItem"\n                    v-on:change-quantity="onChangeQuantity">\n            </payone-order-items>\n\n            <div class="payone-payment-detail--refund-modal--content">\n                <sw-container columns="1fr 1fr" gap="0 32px">\n                    <sw-text-field :disabled="true" :label="$tc(\'sw-order.payone-payment.modal.orderAmount\')" :value="transaction.amount.totalPrice | currency(order.currency.shortName)"></sw-text-field>\n                    <sw-text-field :disabled="true" :label="$tc(\'sw-order.payone-payment.modal.refund.refunded\')" :value="refundedAmount | payone_currency(order.currency.shortName, decimalPrecision)"></sw-text-field>\n                    <sw-text-field :disabled="true" :label="$tc(\'sw-order.payone-payment.modal.remainingAmount\')" :value="remainingAmount | payone_currency(order.currency.shortName, decimalPrecision)"></sw-text-field>\n                    <sw-number-field required="required" numberType="float" :digits="order.decimal_precision" :label="$tc(\'sw-order.payone-payment.modal.refund.amount\')"\n                                     v-model="refundAmount"\n                                     :min="0"\n                                     :max="maxRefundAmount"></sw-number-field>\n                </sw-container>\n            </div>\n\n            <template slot="modal-footer">\n                <sw-button :disabled="isLoading" @click="closeRefundModal">\n                    {{ $tc(\'sw-order.payone-payment.modal.close\') }}\n                </sw-button>\n\n                <sw-button-process :isLoading="isLoading" :processSuccess="isRefundSuccessful" @process-finish="onRefundFinished()" :disabled="isLoading || refundAmount <= 0" variant="primary" @click="refundOrder">\n                    {{ $tc(\'sw-order.payone-payment.modal.refund.submit\') }}\n                </sw-button-process>\n\n                <sw-button-process :isLoading="isLoading" :processSuccess="isRefundSuccessful" @process-finish="onRefundFinished()" :disabled="isLoading" variant="primary" @click="refundFullOrder">\n                    {{ $tc(\'sw-order.payone-payment.modal.refund.fullSubmit\') }}\n                </sw-button-process>\n            </template>\n        </sw-modal>\n    </div>\n{% endblock %}\n',mixins:[s.getByName("notification")],inject:["PayonePaymentService"],props:{order:{type:Object,required:!0},transaction:{type:Object,required:!0}},data:function(){return{isLoading:!1,hasError:!1,showRefundModal:!1,isRefundSuccessful:!1,selection:[],refundAmount:0,includeShippingCosts:!1}},computed:{decimalPrecision:function(){return this.order&&this.order.currency?this.order.currency.decimalPrecision?this.order.currency.decimalPrecision:this.order.currency.itemRounding?this.order.currency.itemRounding.decimals:void 0:2},remainingAmount:function(){return this.transaction.extensions&&this.transaction.extensions.payonePaymentOrderTransactionData&&this.transaction.extensions.payonePaymentOrderTransactionData.capturedAmount?this.transaction.extensions.payonePaymentOrderTransactionData.capturedAmount-this.refundedAmount:0},refundedAmount:function(){return this.transaction.extensions&&this.transaction.extensions.payonePaymentOrderTransactionData&&!this.transaction.extensions.payonePaymentOrderTransactionData.refundedAmount?this.transaction.extensions.payonePaymentOrderTransactionData.refundedAmount:0},maxRefundAmount:function(){return this.remainingAmount/Math.pow(10,this.decimalPrecision)},buttonEnabled:function(){return!(!this.transaction.extensions||!this.transaction.extensions.payonePaymentOrderTransactionData)&&(this.remainingAmount>0&&this.refundedAmount>0||this.transaction.extensions.payonePaymentOrderTransactionData.allowRefund)},hasRemainingRefundableShippingCosts:function(){var e=this;if(this.order.shippingCosts.totalPrice<=0)return!1;var n=this.order.shippingCosts.totalPrice*Math.pow(10,this.decimalPrecision),t=0;return this.order.lineItems.forEach((function(n){n.customFields&&n.customFields.payone_refunded_quantity&&0<n.customFields.payone_refunded_quantity&&(t+=n.customFields.payone_refunded_quantity*n.unitPrice*Math.pow(10,e.decimalPrecision))})),!(this.refundedAmount-Math.round(t)>=n)}},methods:{calculateRefundAmount:function(){var e=0;this.selection.forEach((function(n){n.selected&&(e+=n.unit_price*n.quantity)})),Math.round(e*Math.pow(10,this.decimalPrecision)>this.remainingAmount)&&(e=this.remainingAmount/Math.pow(10,this.decimalPrecision)),this.refundAmount=e},openRefundModal:function(){this.showRefundModal=!0,this.isRefundSuccessful=!1,this.selection=[]},closeRefundModal:function(){this.showRefundModal=!1},onRefundFinished:function(){this.isRefundSuccessful=!1},refundOrder:function(){var e=this,n={orderTransactionId:this.transaction.id,payone_order_id:this.transaction.extensions.payonePaymentOrderTransactionData.transactionId,salesChannel:this.order.salesChannel,amount:this.refundAmount,orderLines:[],complete:this.refundAmount===this.maxRefundAmount,includeShippingCosts:!1};this.isLoading=!0,this.selection.forEach((function(t){e.order.lineItems.forEach((function(i){if(i.id===t.id&&t.selected&&0<t.quantity){var s=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},i),a=s.tax_rate/Math.pow(10,e.decimalPrecision);s.quantity=t.quantity,s.total_amount=s.unit_price*s.quantity,s.total_tax_amount=Math.round(s.total_amount/(100+a)*a),n.orderLines.push(s)}})),"shipping"===t.id&&t.selected&&0<t.quantity&&(n.includeShippingCosts=!0)})),this.PayonePaymentService.refundPayment(n).then((function(){e.createNotificationSuccess({title:e.$tc("sw-order.payone-payment.refund.successTitle"),message:e.$tc("sw-order.payone-payment.refund.successMessage")}),e.isRefundSuccessful=!0})).catch((function(n){e.createNotificationError({title:e.$tc("sw-order.payone-payment.refund.errorTitle"),message:n.message}),e.isRefundSuccessful=!1})).finally((function(){e.isLoading=!1,e.closeRefundModal(),e.$nextTick().then((function(){e.$emit("reload")}))}))},refundFullOrder:function(){var e=this,n={orderTransactionId:this.transaction.id,payone_order_id:this.transaction.extensions.payonePaymentOrderTransactionData.transactionId,salesChannel:this.order.salesChannel,amount:this.maxRefundAmount,orderLines:[],complete:!0,includeShippingCosts:this.hasRemainingRefundableShippingCosts};this.isLoading=!0,this.order.lineItems.forEach((function(e){var t=e.quantity;e.customFields&&e.customFields.payone_refunded_quantity&&0<e.customFields.payone_refunded_quantity&&(t-=e.customFields.payone_refunded_quantity),n.orderLines.push({id:e.id,quantity:t,unit_price:e.unitPrice,selected:!1})})),this.PayonePaymentService.refundPayment(n).then((function(){e.createNotificationSuccess({title:e.$tc("sw-order.payone-payment.refund.successTitle"),message:e.$tc("sw-order.payone-payment.refund.successMessage")}),e.isRefundSuccessful=!0})).catch((function(n){e.createNotificationError({title:e.$tc("sw-order.payone-payment.refund.errorTitle"),message:n.message}),e.isRefundSuccessful=!1})).finally((function(){e.isLoading=!1,e.closeRefundModal(),e.$nextTick().then((function(){e.$emit("reload")}))}))},onSelectItem:function(e,n){0===this.selection.length&&this._populateSelectionProperty(),this.selection.forEach((function(t){t.id===e&&(t.selected=n)})),this.calculateRefundAmount()},onChangeQuantity:function(e,n){0===this.selection.length&&this._populateSelectionProperty(),this.selection.forEach((function(t){t.id===e&&(t.quantity=n)})),this.calculateRefundAmount()},_populateSelectionProperty:function(){var e=this;this.order.lineItems.forEach((function(n){var t=n.quantity;n.customFields&&n.customFields.payone_refunded_quantity&&0<n.customFields.payone_refunded_quantity&&(t-=n.customFields.payone_refunded_quantity),e.selection.push({id:n.id,quantity:t,unit_price:n.unitPrice,selected:!1})})),this.order.shippingCosts.totalPrice>0&&this.selection.push({id:"shipping",quantity:1,unit_price:this.order.shippingCosts.totalPrice,selected:!1})}}}},YRDH:function(e,n,t){var i=t("Jp+7");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,t("ydqr").default)("24043130",i,!0,{})},ydqr:function(e,n,t){"use strict";function i(e,n){for(var t=[],i={},r=0;r<n.length;r++){var o=n[r],s=o[0],a={id:e+":"+r,css:o[1],media:o[2],sourceMap:o[3]};i[s]?i[s].parts.push(a):t.push(i[s]={id:s,parts:[a]})}return t}t.r(n),t.d(n,"default",(function(){return m}));var r="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!r)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},s=r&&(document.head||document.getElementsByTagName("head")[0]),a=null,u=0,d=!1,c=function(){},l=null,f="data-vue-ssr-id",p="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function m(e,n,t,r){d=t,l=r||{};var s=i(e,n);return h(s),function(n){for(var t=[],r=0;r<s.length;r++){var a=s[r];(u=o[a.id]).refs--,t.push(u)}n?h(s=i(e,n)):s=[];for(r=0;r<t.length;r++){var u;if(0===(u=t[r]).refs){for(var d=0;d<u.parts.length;d++)u.parts[d]();delete o[u.id]}}}}function h(e){for(var n=0;n<e.length;n++){var t=e[n],i=o[t.id];if(i){i.refs++;for(var r=0;r<i.parts.length;r++)i.parts[r](t.parts[r]);for(;r<t.parts.length;r++)i.parts.push(g(t.parts[r]));i.parts.length>t.parts.length&&(i.parts.length=t.parts.length)}else{var s=[];for(r=0;r<t.parts.length;r++)s.push(g(t.parts[r]));o[t.id]={id:t.id,refs:1,parts:s}}}}function y(){var e=document.createElement("style");return e.type="text/css",s.appendChild(e),e}function g(e){var n,t,i=document.querySelector("style["+f+'~="'+e.id+'"]');if(i){if(d)return c;i.parentNode.removeChild(i)}if(p){var r=u++;i=a||(a=y()),n=w.bind(null,i,r,!1),t=w.bind(null,i,r,!0)}else i=y(),n=P.bind(null,i),t=function(){i.parentNode.removeChild(i)};return n(e),function(i){if(i){if(i.css===e.css&&i.media===e.media&&i.sourceMap===e.sourceMap)return;n(e=i)}else t()}}var b,v=(b=[],function(e,n){return b[e]=n,b.filter(Boolean).join("\n")});function w(e,n,t,i){var r=t?"":i.css;if(e.styleSheet)e.styleSheet.cssText=v(n,r);else{var o=document.createTextNode(r),s=e.childNodes;s[n]&&e.removeChild(s[n]),s.length?e.insertBefore(o,s[n]):e.appendChild(o)}}function P(e,n){var t=n.css,i=n.media,r=n.sourceMap;if(i&&e.setAttribute("media",i),l.ssrId&&e.setAttribute(f,n.id),r&&(t+="\n/*# sourceURL="+r.sources[0]+" */",t+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}}]);