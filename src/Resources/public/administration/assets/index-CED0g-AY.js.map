{"version":3,"file":"index-CED0g-AY.js","sources":["../../../app/administration/src/module/sw-order/component/payone-payment-webhook-log/payone-payment-webhook-log.html.twig","../../../app/administration/src/module/sw-order/component/payone-payment-webhook-log/index.js"],"sourcesContent":["{% block payone_payment_webhook_log %}\n    <mt-card\n        class=\"payone-payment-webhook-log-card\"\n        position-identifier=\"payone-payment-webhook-log-card\"\n        :title=\"$t('sw-order.payone-payment.webhookLog.cardTitle')\"\n    >\n        <sw-data-grid\n            v-if=\"webhookLogs.length > 0\"\n            :showSelection=\"false\"\n            :dataSource=\"webhookLogs\"\n            :columns=\"webhookLogColumns\"\n            :isLoading=\"isLoading\"\n        >\n            <template #column-webhookDateTime=\"{ item }\">\n                {{ dateFilter(item.webhookDateTime, { hour: '2-digit', minute: '2-digit' }) }}\n            </template>\n\n            <template #actions=\"{ item }\">\n                <sw-context-menu-item @click=\"openDetails(item)\">\n                    {{ $t('sw-order.payone-payment.webhookLog.contextMenu.openWebhookDetails') }}\n                </sw-context-menu-item>\n            </template>\n\n            <template #action-modals=\"{ item }\">\n                <sw-modal\n                    v-if=\"showWebhookDetails\"\n                    :title=\"$t('sw-order.payone-payment.webhookLog.webhookDetailsModal.title')\"\n                    variant=\"large\"\n                    @modal-close=\"onCloseWebhookModal\"\n                >\n                    <mt-button\n                        variant=\"primary\"\n                        @click=\"downloadAsTxt(showWebhookDetails, 'webhook', item.transactionId)\"\n                    >\n                        {{ $t('sw-order.payone-payment.webhookLog.webhookDetailsModal.downloadButton') }}\n                    </mt-button>\n\n                    <sw-data-grid\n                        :showSelection=\"false\"\n                        :showActions=\"false\"\n                        :dataSource=\"toKeyValueSource(showWebhookDetails)\"\n                        :columns=\"keyValueColumns\"\n                        :isLoading=\"isLoading\"\n                    >\n                    </sw-data-grid>\n                </sw-modal>\n            </template>\n        </sw-data-grid>\n\n        <sw-empty-state\n            v-else\n            :absolute=\"false\"\n            :title=\"$t('sw-order.payone-payment.webhookLog.emptyState.title')\"\n            :subline=\"$t('sw-order.payone-payment.webhookLog.emptyState.subline')\"\n        >\n            <template #icon>\n                <img\n                    :src=\"assetFilter('/administration/administration/static/img/empty-states/order-empty-state.svg')\"\n                    :alt=\"$t('sw-order.payone-payment.webhookLog.emptyState.title')\"\n                />\n            </template>\n        </sw-empty-state>\n    </mt-card>\n{% endblock %}","import template from './payone-payment-webhook-log.html.twig';\n\nconst {Criteria} = Shopware.Data;\nconst { Filter } = Shopware;\n\nexport default {\n    template,\n\n    inject: ['repositoryFactory'],\n\n    props: {\n        order: {\n            type: Object,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            webhookLogs: [],\n            isLoading: false,\n            showWebhookDetails: null,\n        };\n    },\n\n    computed: {\n        webhookLogRepository() {\n            return this.repositoryFactory.create('payone_payment_webhook_log');\n        },\n\n        assetFilter() {\n            return Filter.getByName('asset');\n        },\n\n        dateFilter() {\n            return Filter.getByName('date');\n        },\n\n        webhookLogColumns() {\n            return [\n                {\n                    property: 'transactionId',\n                    label: this.$t('sw-order.payone-payment.webhookLog.columnTitleTransactionId')\n                },\n                {\n                    property: 'transactionState',\n                    label: this.$t('sw-order.payone-payment.webhookLog.columnTitleTransactionState')\n                },\n                {\n                    property: 'sequenceNumber',\n                    label: this.$t('sw-order.payone-payment.webhookLog.columnTitleSequenceNumber')\n                },\n                {\n                    property: 'clearingType',\n                    label: this.$t('sw-order.payone-payment.webhookLog.columnTitleClearingType')\n                },\n                {\n                    property: 'webhookDateTime',\n                    label: this.$t('sw-order.payone-payment.webhookLog.columnTitleWebhookDateTime')\n                },\n            ];\n        },\n\n        keyValueColumns() {\n            return [\n                {property: 'key', label: this.$t('sw-order.payone-payment.webhookLog.columnTitleKey')},\n                {property: 'value', label: this.$t('sw-order.payone-payment.webhookLog.columnTitleValue')},\n            ];\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.getWebhookLogs();\n        },\n\n        reloadWebhookLogs() {\n            this.getWebhookLogs();\n        },\n\n        getWebhookLogs() {\n            const criteria = new Criteria();\n            criteria.addFilter(Criteria.equals('orderId', this.order.id));\n            criteria.addSorting(Criteria.sort('webhookDateTime', 'ASC', true));\n\n            this.isLoading = true;\n            return this.webhookLogRepository.search(criteria, Shopware.Context.api).then((searchResult) => {\n                this.webhookLogs = searchResult;\n                this.isLoading = false;\n            });\n        },\n\n        openDetails(webhookLog) {\n            this.showWebhookDetails = webhookLog.webhookDetails;\n        },\n\n        onCloseWebhookModal() {\n            this.showWebhookDetails = null;\n        },\n\n        toKeyValueSource(object) {\n            const data = [];\n\n            for (const key in object) {\n                data.push({key, value: object[key]});\n            }\n\n            data.sort((a, b) => a.key.localeCompare(b.key));\n\n            return data;\n        },\n\n        downloadAsTxt(object, objectType, id) {\n            const link = document.createElement('a');\n            link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(JSON.stringify(object, null, 4));\n            link.download = `PAYONE-${objectType}-${id}.txt`;\n            link.dispatchEvent(new MouseEvent('click'));\n            link.remove();\n        },\n    }\n};\n"],"names":["template","Criteria","Filter","index","criteria","searchResult","webhookLog","object","data","key","a","b","objectType","id","link"],"mappings":"AAAA,MAAAA,EAAe,ksDCET,CAAC,SAAAC,CAAQ,EAAI,SAAS,KACtB,CAAE,OAAAC,CAAM,EAAK,SAEnBC,EAAe,CACX,SAAAH,EAEA,OAAQ,CAAC,mBAAmB,EAE5B,MAAO,CACH,MAAO,CACH,KAAM,OACN,SAAU,EACtB,CACA,EAEI,MAAO,CACH,MAAO,CACH,YAAa,CAAA,EACb,UAAW,GACX,mBAAoB,IAChC,CACA,EAEI,SAAU,CACN,sBAAuB,CACnB,OAAO,KAAK,kBAAkB,OAAO,4BAA4B,CAC7E,EAEQ,aAAc,CACV,OAAOE,EAAO,UAAU,OAAO,CAC3C,EAEQ,YAAa,CACT,OAAOA,EAAO,UAAU,MAAM,CAC1C,EAEQ,mBAAoB,CAChB,MAAO,CACH,CACI,SAAU,gBACV,MAAO,KAAK,GAAG,6DAA6D,CAChG,EACgB,CACI,SAAU,mBACV,MAAO,KAAK,GAAG,gEAAgE,CACnG,EACgB,CACI,SAAU,iBACV,MAAO,KAAK,GAAG,8DAA8D,CACjG,EACgB,CACI,SAAU,eACV,MAAO,KAAK,GAAG,4DAA4D,CAC/F,EACgB,CACI,SAAU,kBACV,MAAO,KAAK,GAAG,+DAA+D,CAClG,CACA,CACA,EAEQ,iBAAkB,CACd,MAAO,CACH,CAAC,SAAU,MAAO,MAAO,KAAK,GAAG,mDAAmD,CAAC,EACrF,CAAC,SAAU,QAAS,MAAO,KAAK,GAAG,qDAAqD,CAAC,CACzG,CACA,CACA,EAEI,SAAU,CACN,KAAK,iBAAgB,CAC7B,EAEI,QAAS,CACL,kBAAmB,CACf,KAAK,eAAc,CAC/B,EAEQ,mBAAoB,CAChB,KAAK,eAAc,CAC/B,EAEQ,gBAAiB,CACb,MAAME,EAAW,IAAIH,EACrB,OAAAG,EAAS,UAAUH,EAAS,OAAO,UAAW,KAAK,MAAM,EAAE,CAAC,EAC5DG,EAAS,WAAWH,EAAS,KAAK,kBAAmB,MAAO,EAAI,CAAC,EAEjE,KAAK,UAAY,GACV,KAAK,qBAAqB,OAAOG,EAAU,SAAS,QAAQ,GAAG,EAAE,KAAMC,GAAiB,CAC3F,KAAK,YAAcA,EACnB,KAAK,UAAY,EACjC,CAAa,CACb,EAEQ,YAAYC,EAAY,CACpB,KAAK,mBAAqBA,EAAW,cACjD,EAEQ,qBAAsB,CAClB,KAAK,mBAAqB,IACtC,EAEQ,iBAAiBC,EAAQ,CACrB,MAAMC,EAAO,CAAA,EAEb,UAAWC,KAAOF,EACdC,EAAK,KAAK,CAAC,IAAAC,EAAK,MAAOF,EAAOE,CAAG,CAAC,CAAC,EAGvC,OAAAD,EAAK,KAAK,CAACE,EAAGC,IAAMD,EAAE,IAAI,cAAcC,EAAE,GAAG,CAAC,EAEvCH,CACnB,EAEQ,cAAcD,EAAQK,EAAYC,EAAI,CAClC,MAAMC,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAO,iCAAmC,mBAAmB,KAAK,UAAUP,EAAQ,KAAM,CAAC,CAAC,EACjGO,EAAK,SAAW,UAAUF,CAAU,IAAIC,CAAE,OAC1CC,EAAK,cAAc,IAAI,WAAW,OAAO,CAAC,EAC1CA,EAAK,OAAM,CACvB,CACA,CACA"}