const n=`{% block payone_payment_payment_details %} <div class="payone-capture-button"> <sw-container v-tooltip="{message: $t('sw-order.payone-payment.capture.tooltips.impossible'), disabled: buttonEnabled}" :key="buttonEnabled" > <mt-button :disabled="!buttonEnabled" @click="openCaptureModal" variant="secondary" size="default" > {{ $t('sw-order.payone-payment.capture.buttonTitle') }} </mt-button> </sw-container> <sw-modal v-if="showCaptureModal" @modal-close="closeCaptureModal" :title="$t(\`sw-order.payone-payment.modal.capture.title\`)" class="payone-payment-detail--capture-modal" > <payone-order-items :order="order" :items="items" ></payone-order-items> <div class="payone-payment-detail--capture-modal--content"> <sw-container columns="1fr 1fr" gap="0 32px" > <mt-text-field :disabled="true" :label="$t('sw-order.payone-payment.modal.orderAmount')" :model-value="currencyFilter(transaction.amount.totalPrice, order.currency.shortName)" ></mt-text-field> <mt-text-field :disabled="true" :label="$t('sw-order.payone-payment.modal.capture.captured')" :model-value="currencyFilter(capturedAmount, order.currency.shortName)" ></mt-text-field> <mt-text-field :disabled="true" :label="$t('sw-order.payone-payment.modal.remainingAmount')" :model-value="currencyFilter(remainingAmount, order.currency.shortName)" ></mt-text-field> <mt-number-field required="required" numberType="float" :digits="decimalPrecision" :label="$t('sw-order.payone-payment.modal.capture.amount')" v-model="captureAmount" :min="0" :max="remainingAmount" ></mt-number-field> </sw-container> </div> <template #modal-footer> <mt-button :disabled="isLoading" @click="closeCaptureModal" variant="secondary" > {{ $t('sw-order.payone-payment.modal.close') }} </mt-button> <sw-button-process :isLoading="isLoading" :processSuccess="isCaptureSuccessful" @process-finish="onCaptureFinished()" :disabled="isLoading || captureAmount <= 0" variant="primary" @click="captureOrder" > {{ $t('sw-order.payone-payment.modal.capture.submit') }} </sw-button-process> <sw-button-process :isLoading="isLoading" :processSuccess="isCaptureSuccessful" @process-finish="onCaptureFinished()" :disabled="isLoading || remainingAmount <= 0" variant="primary" @click="captureFullOrder" > {{ $t('sw-order.payone-payment.modal.capture.fullSubmit') }} </sw-button-process> </template> </sw-modal> </div> {% endblock %}`,{Mixin:s,Filter:r}=Shopware,o={template:n,mixins:[s.getByName("notification")],inject:["PayonePaymentService"],props:{order:{type:Object,required:!0},transaction:{type:Object,required:!0}},data(){return{isLoading:!1,hasError:!1,showCaptureModal:!1,isCaptureSuccessful:!1,captureAmount:0,includeShippingCosts:!1,items:[]}},computed:{currencyFilter(){return r.getByName("currency")},payoneCurrencyFilter(){return r.getByName("payone_currency")},orderTotalPrice(){return this.transaction.amount.totalPrice},decimalPrecision(){if(!this.order||!this.order.currency)return 2;if(this.order.currency.decimalPrecision)return this.order.currency.decimalPrecision;if(this.order.currency.itemRounding)return this.order.currency.itemRounding.decimals},capturedAmount(){var e,t,i;return this.toFixedPrecision((((i=(t=(e=this.transaction)==null?void 0:e.extensions)==null?void 0:t.payonePaymentOrderTransactionData)==null?void 0:i.capturedAmount)??0)/100)},remainingAmount(){return this.toFixedPrecision(this.orderTotalPrice-this.capturedAmount)},buttonEnabled(){var e,t;return(t=(e=this.transaction)==null?void 0:e.extensions)!=null&&t.payonePaymentOrderTransactionData?this.remainingAmount>0||this.transaction.extensions.payonePaymentOrderTransactionData.allowCapture:!1},selectedItems(){return this.items.filter(e=>e.selected&&e.quantity>0)},hasRemainingShippingCosts(){return this.order.shippingCosts.totalPrice<=0?!1:this.toFixedPrecision(this.capturedAmount+this.order.shippingCosts.totalPrice)<=this.orderTotalPrice}},methods:{toFixedPrecision(e){return Math.round(e*10**this.decimalPrecision)/10**this.decimalPrecision},calculateActionAmount(){let e=0;this.selectedItems.forEach(t=>{e+=t.unit_price*t.quantity}),this.captureAmount=this.toFixedPrecision(e>this.remainingAmount?this.remainingAmount:e)},openCaptureModal(){this.showCaptureModal=!0,this.isCaptureSuccessful=!1,this.initItems()},initItems(){this.items=this.order.lineItems.map(e=>{var i;const t=e.quantity-(((i=e.customFields)==null?void 0:i.payone_captured_quantity)??0);return{id:e.id,quantity:t,maxQuantity:t,unit_price:e.unitPrice,selected:!1,product:e.label,orderItem:e,disabled:t<=0}}),this.order.shippingCosts.totalPrice>0&&this.items.push({id:"shipping",quantity:1,maxQuantity:1,unit_price:this.order.shippingCosts.totalPrice,selected:!1,disabled:!1,product:this.$t("sw-order.payone-payment.modal.shippingCosts")})},closeCaptureModal(){this.showCaptureModal=!1},onCaptureFinished(){this.isCaptureSuccessful=!1},captureOrder(){const e={orderTransactionId:this.transaction.id,payone_order_id:this.transaction.extensions.payonePaymentOrderTransactionData.transactionId,salesChannel:this.order.salesChannel,amount:this.captureAmount,orderLines:[],complete:this.captureAmount===this.remainingAmount,includeShippingCosts:!1};this.isLoading=!0,this.selectedItems.forEach(t=>{if(t.id==="shipping")e.includeShippingCosts=!0;else{const i=this.order.lineItems.find(a=>a.id===t.id);if(i){const a={...i};a.quantity=t.quantity,a.total_amount=a.unit_price*a.quantity,a.total_tax_amount=a.total_amount-a.total_amount/(1+a.tax_rate/100),e.orderLines.push(a)}}}),this.remainingAmount<e.amount&&(e.amount=this.remainingAmount),this.executeCapture(e)},captureFullOrder(){const e={orderTransactionId:this.transaction.id,payone_order_id:this.transaction.extensions.payonePaymentOrderTransactionData.transactionId,salesChannel:this.order.salesChannel,amount:this.remainingAmount,orderLines:[],complete:!0,includeShippingCosts:this.hasRemainingShippingCosts};this.isLoading=!0,e.orderLines=this.order.lineItems.map(t=>{var i;return{id:t.id,quantity:t.quantity-(((i=t.customFields)==null?void 0:i.payone_captured_quantity)??0),unit_price:t.unitPrice,selected:!1}}),this.executeCapture(e)},executeCapture(e){this.PayonePaymentService.capturePayment(e).then(()=>{this.createNotificationSuccess({title:this.$t("sw-order.payone-payment.capture.successTitle"),message:this.$t("sw-order.payone-payment.capture.successMessage")}),this.isCaptureSuccessful=!0}).catch(t=>{this.createNotificationError({title:this.$t("sw-order.payone-payment.capture.errorTitle"),message:t.message}),this.isCaptureSuccessful=!1}).finally(()=>{this.isLoading=!1,this.closeCaptureModal(),this.$nextTick().then(()=>{this.$emit("reload")})})}},watch:{items:{handler(){this.calculateActionAmount()},deep:!0}}};export{o as default};
//# sourceMappingURL=index-CPA72YU3.js.map
